# ๐ฌ Java UniqueList Performance Benchmark

[![Java](https://img.shields.io/badge/Java-21%2B-orange)](https://openjdk.org/)
[![JMH](https://img.shields.io/badge/JMH-1.37-blue)](https://github.com/openjdk/jmh)
[![JUnit](https://img.shields.io/badge/JUnit-5-green)](https://junit.org/)

## ๐ ะ ะฟัะพะตะบัะต

**UniqueList Benchmark** โ ััะพ ะธััะปะตะดะพะฒะฐัะตะปััะบะธะน ะฟัะพะตะบั, ะดะตะผะพะฝัััะธััััะธะน ัะฐะทะปะธัะฝัะต ะฟะพะดัะพะดั ะบ ัะตะฐะปะธะทะฐัะธะธ ะฟะพัะพะบะพะฑะตะทะพะฟะฐัะฝะพะน ะบะพะปะปะตะบัะธะธ, ะบะพัะพัะฐั ะณะฐัะฐะฝัะธััะตั ัะฝะธะบะฐะปัะฝะพััั ัะปะตะผะตะฝัะพะฒ. ะัะพะตะบั ะฒะบะปััะฐะตั ััะฐะฒะฝะตะฝะธะต ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ัะธะฝััะพะฝะธะทะธัะพะฒะฐะฝะฝัั ะธ lock-free ัะตะฐะปะธะทะฐัะธะน ะฒ ะผะฝะพะณะพะฟะพัะพัะฝะพะน ััะตะดะต ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ Java Microbenchmark Harness (JMH).

### ๐ฏ ะัะฝะพะฒะฝะฐั ะทะฐะดะฐัะฐ

ะกะพะทะดะฐัั ะบะพะปะปะตะบัะธั `IUniqueList<T>`, ะบะพัะพัะฐั:
- ะฅัะฐะฝะธั ัะพะปัะบะพ ัะฝะธะบะฐะปัะฝัะต ัะปะตะผะตะฝัั (ะฑะตะท ะดัะฑะปะธะบะฐัะพะฒ)
- ะะพััะตะบัะฝะพ ัะฐะฑะพัะฐะตั ะฒ ะผะฝะพะณะพะฟะพัะพัะฝะพะน ััะตะดะต
- ะะฑะตัะฟะตัะธะฒะฐะตั ะผะฐะบัะธะผะฐะปัะฝัั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

## ๐ ะััะธัะตะบัััะฐ
```
โโโโโโโโโโโโโโโโโโโ
โ IUniqueList     โ
โ (interface)     โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
โโโโโโโโโโผโโโโโโโโโโโ
โSimpleNonUniqueListโ
โ (ะฑะฐะทะพะฒัะน ะบะปะฐัั)   โ
โโโโโโโโโโฌโโโโโโโโโโโ
         โ
    โโโโโโดโโโโโโโ
    โ           โ
โโโโโผโโโโ โโโโโโโผโโโโโโโ
โSimple โ โSynchronizedโ
โUnique โ โ Method     โ
โโโโโโโโโ โโโโโโโโโโโโโโ
... ะธ ะดััะณะธะต ัะตะฐะปะธะทะฐัะธะธ
```
## โ๏ธ ะะตะฐะปะธะทะฐัะธะธ

### 1. **SimpleUniqueList** (ะญัะฐะปะพะฝ)
ะะฐะทะพะฒะฐั ะฝะตัะธะฝััะพะฝะธะทะธัะพะฒะฐะฝะฝะฐั ัะตะฐะปะธะทะฐัะธั. ะัะฟะพะปัะทัะตััั ะบะฐะบ reference point ะดะปั ััะฐะฒะฝะตะฝะธั.

### 2. **Synchronized Method**
```java
public synchronized boolean add(T e) {
    if (!list.contains(e)) {
        return list.add(e);
    }
    return false;
}
```
ะกะธะฝััะพะฝะธะทะฐัะธั ะฝะฐ ััะพะฒะฝะต ะผะตัะพะดะฐ โ ัะฐะผัะน ะฟัะพััะพะน, ะฝะพ ะฟะพัะตะฝัะธะฐะปัะฝะพ ะผะตะดะปะตะฝะฝัะน ะฟะพะดัะพะด.

### 3. Synchronized Section
```java
while (!added && !list.contains(e)) {
    if (lock.tryLock()) {
        try { /* ะบัะธัะธัะตัะบะฐั ัะตะบัะธั */ } 
        finally { lock.unlock(); }
    } else {
        Thread.yield();
    }
}
```
ะกะธะฝััะพะฝะธะทะฐัะธั ะฝะฐ ะพะฑัะตะบัะต ัะฟะธัะบะฐ โ ะฑะพะปะตะต ัะพะฝะบะธะน ะบะพะฝััะพะปั ะฝะฐะด ะบัะธัะธัะตัะบะพะน ัะตะบัะธะตะน.
### 4. ReentrantLock
```java
while (!added && !list.contains(e)) {
    if (lock.tryLock()) {
        try { /* ะบัะธัะธัะตัะบะฐั ัะตะบัะธั */ } 
        finally { lock.unlock(); }
    } else {
        Thread.yield();
    }
}
```
ะัะฟะพะปัะทะพะฒะฐะฝะธะต ReentrantLock ั ะฝะตะฑะปะพะบะธััััะตะน ะฟะพะฟััะบะพะน ะทะฐัะฒะฐัะฐ.

### 5. AtomicBoolean Lock
```java
while (!added && !list.contains(e)) {
    if (islocked.compareAndSet(false, true)) {
        try { /* ะบัะธัะธัะตัะบะฐั ัะตะบัะธั */ } 
        finally { islocked.set(false); }
    } else {
        Thread.yield();
    }
}
```
ะกะฐะผะพะดะตะปัะฝัะน spin-lock ะฝะฐ ะพัะฝะพะฒะต AtomicBoolean ะธ CAS-ะพะฟะตัะฐัะธะน.

### 6. Valid Volatile Lock
```java
private volatile boolean islocked = false;

private boolean tryLock() {
    if (islocked) return false;
    synchronized(list) {
        if (!islocked) {
            islocked = true;
            return true;
        }
        return false;
    }
}
```
ะะพะผะฑะธะฝะฐัะธั volatile ะดะปั ะฑััััะพะน ะฟัะพะฒะตัะบะธ ะธ synchronized ะดะปั ะฐัะพะผะฐัะฝะพััะธ.

### 7. โ๏ธ NonValidVolatileLock
ะะตะผะพะฝัััะฐัะธั ะฝะตะบะพััะตะบัะฝะพะน ัะตะฐะปะธะทะฐัะธะธ โ ะบะพะณะดะฐ ะปะพัะธั ะฒ ะพะดะฝะพะผ ะฟะพัะพะบะต, ัะพ ะฝะต ะฟะพะทะฒะพะปัะตั ะดััะณะธะผ ะฟะพัะพะบะฐะผ ะดะพะฑะฐะฒะปััั ัะปะตะผะตะฝัั.

## ๐ ะะตะทัะปััะฐัั ะฑะตะฝัะผะฐัะบะพะฒ
```
Throughput (ะพะฟะตัะฐัะธะน/ัะตะบ) ะฟัะธ ัะฐะทะฝะพะผ ะบะพะปะธัะตััะฒะต ะฟะพัะพะบะพะฒ
Implementation	2 ะฟะพัะพะบะฐ	4 ะฟะพัะพะบะฐ	8 ะฟะพัะพะบะพะฒ	16 ะฟะพัะพะบะพะฒ
Synchronized Method	1.01 M	0.39 M	0.14 M	0.55 M
Synchronized Section	1.00 M	0.39 M	0.15 M	0.46 M
AtomicBoolean Lock	1.50 M	2.67 M	2.59 M	1.19 M
Valid Volatile Lock	1.49 M	2.54 M	2.61 M	1.29 M
ReentrantLock	1.50 M	2.60 M	2.59 M	1.38 M
```

## ะกะฑะพัะบะฐ ะธ ัะตััะธัะพะฒะฐะฝะธะต
```bash
# ะะฐะฟััะบ ะฒัะตั ัะตััะพะฒ
mvn test

# ะะฐะฟััะบ JMH ะฑะตะฝัะผะฐัะบะพะฒ
mvn clean package
java -jar target/benchmarks.jar

# ะะตะฝะตัะฐัะธั ะพััะตัะฐ ั ะณัะฐัะธะบะฐะผะธ
cd scripts
./report.sh ../results/multithread-results.json report.py
```

## ๐ ะะธะทัะฐะปะธะทะฐัะธั
ะกะบัะธะฟั report.py ะณะตะฝะตัะธััะตั:

๐ ะกัะฐะฒะฝะธัะตะปัะฝัะต ะณัะฐัะธะบะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ
๐ ะะฝะดะธะฒะธะดัะฐะปัะฝัะต ะณัะฐัะธะบะธ ะดะปั ะบะฐะถะดะพะน ัะตะฐะปะธะทะฐัะธะธ
๐ PDF-ะพััะตั ัะพ ัะฒะพะดะฝัะผะธ ัะฐะฑะปะธัะฐะผะธ
๐ CSV-ัะฐะนะปั ะดะปั ะดะฐะปัะฝะตะนัะตะณะพ ะฐะฝะฐะปะธะทะฐ

ะัะธะผะตั ะณัะฐัะธะบะฐ
https://github.com/alexofo83i/javatests/reports/throughput_vs_threads.png


## ๐ ะขะตััะธัะพะฒะฐะฝะธะต ะบะพััะตะบัะฝะพััะธ
ะัะพะตะบั ะฒะบะปััะฐะตั ะบะพะผะฟะปะตะบัะฝัะต ัะตััั:

โ ะะดะฝะพะฟะพัะพัะฝัะต ััะตะฝะฐัะธะธ
โ ะะฝะพะณะพะฟะพัะพัะฝัะต ััะตะฝะฐัะธะธ ั CountDownLatch
โ ะขะตััั ั "ะผะตะดะปะตะฝะฝัะผะธ" ะพะฟะตัะฐัะธัะผะธ ะดะปั ะฒััะฒะปะตะฝะธั race conditions
โ ะะฐะปะธะดะฐัะธั ัะฝะธะบะฐะปัะฝะพััะธ ัะปะตะผะตะฝัะพะฒ

๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ
```text
src/
โโโ main/
โ   โโโ java/org/fedorov/uniq/lists/
โ       โโโ IUniqueList.java           # ะะฝัะตััะตะนั
โ       โโโ impl/                      # ะะตะฐะปะธะทะฐัะธะธ
โ           โโโ SimpleNonUniqueList.java
โ           โโโ SimpleUniqueList.java
โ           โโโ SynchronizedMethodUniqueList.java
โ           โโโ SynchronizedSectionUniqueList.java
โ           โโโ ReentrantLockedUniqueList.java
โ           โโโ AtomicBooleanLockedUniqueList.java
โ           โโโ ValidVolatileLockedUniqueList.java
โ           โโโ NonValidVolatileLockedUniqueList.java
โ
โโโ test/
    โโโ java/org/fedorov/uniq/lists/
        โโโ IUniqueListJUnitTest.java  # ะะฐัะฐะผะตััะธะทะพะฒะฐะฝะฝัะต ัะตััั
        โโโ MultiThreadUniqueListBenchmark.java # JMH ะฑะตะฝัะผะฐัะบ
```